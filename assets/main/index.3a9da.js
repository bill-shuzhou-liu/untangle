window.__require=function t(o,e,n){function i(r,a){if(!e[r]){if(!o[r]){var p=r.split("/");if(p=p[p.length-1],!o[p]){var c="function"==typeof __require&&__require;if(!a&&c)return c(p,!0);if(s)return s(p,!0);throw new Error("Cannot find module '"+r+"'")}r=p}var l=e[r]={exports:{}};o[r][0].call(l.exports,function(t){return i(o[r][1][t]||t)},l,l.exports,t,o,e,n)}return e[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<n.length;r++)i(n[r]);return i}({ball:[function(t,o,e){"use strict";cc._RF.push(o,"e4144V/EBRB3LbNGqQbWVqX","ball");var n=this&&this.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),i=this&&this.__decorate||function(t,o,e,n){var i,s=arguments.length,r=s<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,o,e,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(s<3?i(r):s>3?i(o,e,r):i(o,e))||r);return s>3&&r&&Object.defineProperty(o,e,r),r};Object.defineProperty(e,"__esModule",{value:!0});var s=cc._decorator,r=s.ccclass,a=s.property,p=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.icon=null,o.icon_select=null,o.text="hello",o.adj_balls=[],o}return n(o,t),o.prototype.update_parent=function(t){this.node.getParent().getComponent("draw").set_update(t)},o.prototype.onLoad=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(o){o.getLocation();t.getComponent(cc.Sprite).spriteFrame=t.icon_select,t.update_parent(t.node)}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(o){var e=o.getLocation();t.node.x=e.x,t.node.y=e.y,t.update_parent(t.node)}),this.node.on(cc.Node.EventType.TOUCH_END,function(o){o.getLocation();t.getComponent(cc.Sprite).spriteFrame=t.icon,t.update_parent(null),t.node.getParent().getComponent("draw").onMoveEnd()})},o.prototype.add_adj=function(t){this.adj_balls.push(t)},o.prototype.get_adj=function(){return this.adj_balls},o.prototype.start=function(){},i([a(cc.SpriteFrame)],o.prototype,"icon",void 0),i([a(cc.SpriteFrame)],o.prototype,"icon_select",void 0),i([a],o.prototype,"text",void 0),o=i([r],o)}(cc.Component);e.default=p,cc._RF.pop()},{}],draw:[function(t,o,e){"use strict";cc._RF.push(o,"4833dLNfuNGMI7s6IEYj8lH","draw");var n=this&&this.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),i=this&&this.__decorate||function(t,o,e,n){var i,s=arguments.length,r=s<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,o,e,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(s<3?i(r):s>3?i(o,e,r):i(o,e))||r);return s>3&&r&&Object.defineProperty(o,e,r),r};Object.defineProperty(e,"__esModule",{value:!0});var s=t("./game"),r=cc._decorator,a=r.ccclass,p=r.property,c=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.time_elapse=null,o.move_step=null,o.score=null,o.levels=null,o.next=null,o.reStart=null,o.target=null,o.balls=[],o.stopTimer=!1,o.select_ball=null,o.updated=!1,o.game=new s.default,o.time_spend=0,o.step_move=0,o.total_score=0,o.level=1,o}return n(o,t),o.prototype.set_update=function(t){this.select_ball=t,this.updated=!0},o.prototype.load_ball=function(t){t?this.game.restart_game():this.game.setLinesAndPoints(this.level);for(var o=0,e=this.game.points;o<e.length;o++){var n=e[o],i=cc.instantiate(this.target);i.x=n.pos[0],i.y=n.pos[1],this.node.addChild(i),this.balls.push(i)}for(var s=0,r=this.balls;s<r.length;s++)for(var a=r[s],p={pos:[a.x,a.y]},c=0,l=this.game.getAdjacentPoints(p);c<l.length;c++)for(var h=l[c],u=0,f=this.balls;u<f.length;u++){var d=f[u];h.pos[0]==d.x&&h.pos[1]==d.y&&a.getComponent("ball").add_adj(d)}},o.prototype.redraw=function(){var t=this.getComponent(cc.Graphics);t.clear();var o=this.get_select_index();-1!=o&&this.game.points[o];for(var e=0,n=this.game.lines;e<n.length;e++){var i=n[e];t.strokeColor=(new cc.Color).fromHEX("#00ff00"),i.intersectionPositions.length>0&&(t.strokeColor=(new cc.Color).fromHEX("#ff0000")),t.moveTo(i.startPoint.pos[0],i.startPoint.pos[1]),t.lineTo(i.endPoint.pos[0],i.endPoint.pos[1]),t.stroke()}},o.prototype.onLoad=function(){this.loadData(),this.reloadGame(!1)},o.prototype.setButtonText=function(t){this.next.node.getChildByName("Background").getChildByName("Label").getComponent(cc.Label).string=t},o.prototype.onMoveEnd=function(){if(this.step_move+=1,this.move_step.string="Move:"+this.step_move,0==this.game.intersectionCount)return this.total_score+=10,this.score.string="Score:"+this.total_score,this.stopTimer=!0,this.setButtonText("Next"),void this.saveData()},o.prototype.saveData=function(){var t={score:this.total_score};cc.sys.localStorage.setItem("userData",JSON.stringify(t))},o.prototype.loadData=function(){var t=cc.sys.localStorage.getItem("userData");if(null!=t){var o=JSON.parse(t);this.total_score=o.score}},o.prototype.reloadGame=function(t){this.select_ball=null,this.time_spend=0,this.step_move=0,this.balls.forEach(function(t){t.removeFromParent()}),this.stopTimer=!1,this.balls=[],this.select_ball=null,this.setButtonText("Another try"),this.level=Math.ceil(this.total_score/30+1),this.time_elapse.string="Time:"+this.time_spend,this.move_step.string="Move:"+this.step_move,this.score.string="Score:"+this.total_score,this.levels.string="Level:"+this.level,this.load_ball(t),this.redraw()},o.prototype.start=function(){this.schedule(function(){this.stopTimer||(this.time_spend++,this.time_elapse.string="Time:"+this.time_spend)},1),this.next.node.on("click",this.reload_callback,this),this.reStart.node.on("click",this.restart_callback,this)},o.prototype.reload_callback=function(){this.reloadGame(!1)},o.prototype.restart_callback=function(){this.stopTimer&&(this.total_score-=10),this.reloadGame(!0)},o.prototype.get_select_index=function(){if(null==this.select_ball)return-1;for(var t=0;t<this.balls.length;t++)if(this.balls[t]==this.select_ball)return t;return-1},o.prototype.updateMovingPoint=function(){var t=this.get_select_index();-1!=t&&this.game.updateMovingPoint(t,this.select_ball)},o.prototype.update=function(t){this.updated&&(this.updateMovingPoint(),this.redraw(),this.updated=!1)},i([p(cc.Label)],o.prototype,"time_elapse",void 0),i([p(cc.Label)],o.prototype,"move_step",void 0),i([p(cc.Label)],o.prototype,"score",void 0),i([p(cc.Label)],o.prototype,"levels",void 0),i([p(cc.Button)],o.prototype,"next",void 0),i([p(cc.Button)],o.prototype,"reStart",void 0),i([p(cc.Prefab)],o.prototype,"target",void 0),o=i([a],o)}(cc.Component);e.default=c,cc._RF.pop()},{"./game":"game"}],game:[function(t,o,e){"use strict";cc._RF.push(o,"008af0DBjND36cVVa/9h8Xl","game"),Object.defineProperty(e,"__esModule",{value:!0});var n=t("./utility"),i=t("./line"),s=function(){function t(){this.points=[],this.pointPositions=[],this.initialPoints=[],this.initialPointPositions=[],this.lines=[],this.movingLines=[],this.movingPoint={},this.intersectionCount=0,this.Util=new n.default}return t.prototype.makePoints=function(t){for(this.points=[],this.pointPositions=[],this.initialPoints=[],this.initialPointPositions=[];this.points.length<t;){var o=Math.floor(Math.random()*(this.Util.DIM_X-260)+130),e=Math.floor(Math.random()*(this.Util.DIM_Y-260)+130);if(this.Util.hasEnoughSpace([o,e],this.pointPositions)){this.pointPositions.push([o,e]),this.initialPointPositions.push([o,e]);var n={pos:[o,e]},i={pos:[o,e]};this.points.push(n),this.initialPoints.push(i)}}},t.prototype.makeBaseLines=function(t){this.lines=[];for(var o=0;o<t;o++){var e=this.points[o],n=this.points[o+1]?this.points[o+1]:this.points[0],s=new i.default(e,n);this.lines.push(s)}},t.prototype.makeConnectingLines=function(t){var o,e,n=this;t>0&&function(){o=n.points[0],e=n.points[3];var t=new i.default(o,e);n.lines.push(t)}(),t>1&&function(){o=n.points[0],e=n.points[4];var t=new i.default(o,e);n.lines.push(t)}(),t>2&&function(){o=n.points[n.points.length-1],e=n.points[5];var t=new i.default(o,e);n.lines.push(t)}(),t>3&&function(t){for(var s=0;s<t;s++){o=n.points[n.points.length-1],e=n.points[n.points.length-(s+5)];var r=new i.default(o,e);n.lines.push(r),t-=1}}(t-3)},t.prototype.setLinesAndPoints=function(t){var o=t,e=Math.floor(t/2);t<2?o+=4:t<3?(o+=4,e=1):t<6?(o+=3,e=2):t<8?(o+=2,e=3):t<10?(o+=1,e=4):t>14&&(o-=Math.floor(t/4),t>16&&(e=7)),this.makePoints(o),this.makeBaseLines(o),this.makeConnectingLines(e),this.setIntersectionData(this.lines),0==this.intersectionCount&&this.setLinesAndPoints(t)},t.prototype.setLineAndPoints_test=function(){var t=this,o=[[375,338],[355.5,294],[129.5,183],[384.5,250],[135,250],[133.5,331]];o.forEach(function(o){var e=o[0],n=o[1];t.pointPositions.push([e,n]),t.initialPointPositions.push([e,n]);var i={pos:[e,n]},s={pos:[e,n]};t.points.push(i),t.initialPoints.push(s)}),this.makeBaseLines(o.length),this.makeConnectingLines(1),this.setIntersectionData(this.lines)},t.prototype.getAdjacentPoints=function(t){for(var o=[],e=0,n=this.lines;e<n.length;e++){var i=n[e];this.Util.samePos(i.endPoint.pos,t.pos)&&o.push(i.startPoint),this.Util.samePos(i.startPoint.pos,t.pos)&&o.push(i.endPoint)}return o},t.prototype.setIntersectionData=function(t){i.default.setIntersectionPositions(t),this.countIntersections()},t.prototype.countIntersections=function(){var t=this.movingLines.length>1?[].concat(this.lines,this.movingLines):this.lines;this.intersectionCount=i.default.intersectionCount(t)},t.prototype.updateMovingPoint=function(t,o){var e=this.points[t];e.pos[0]=o.x,e.pos[1]=o.y,this.pointPositions[t][0]=o.x,this.pointPositions[t][1]=o.y,this.setIntersectionData(this.lines)},t.prototype.isPlanar=function(){return this.countIntersections(),Boolean(this.intersectionCount<1)},t.prototype.restart_game=function(){var t=this;this.points=[],this.pointPositions=[],this.initialPointPositions=[],this.lines=[],this.intersectionCount=0,this.initialPoints.forEach(function(o){var e=o.pos[0],n=o.pos[1];t.pointPositions.push([e,n]),t.initialPointPositions.push([e,n]);var i={pos:[e,n]};t.points.push(i)}),this.makeBaseLines(this.initialPoints.length),this.makeConnectingLines(1),this.setIntersectionData(this.lines)},t}();e.default=s,cc._RF.pop()},{"./line":"line","./utility":"utility"}],line:[function(t,o,e){"use strict";cc._RF.push(o,"30118g5g9JN6J5TmbWOV1Yr","line"),Object.defineProperty(e,"__esModule",{value:!0});var n=t("./utility"),i=function(){function t(t,o){this.startPoint=null,this.endPoint=null,this.slope=null,this.yIntercept=null,this.intersectionPositions=[],this.Util=new n.default,this.startPoint=t,this.endPoint=o,this.setSlopeAndYIntercept()}return t.prototype.setSlopeAndYIntercept=function(){this.slope=(this.startPoint.pos[1]-this.endPoint.pos[1])/(this.startPoint.pos[0]-this.endPoint.pos[0]),this.yIntercept=this.startPoint.pos[1]-this.slope*this.startPoint.pos[0]},t.prototype.equals=function(t){return Boolean(this.startPoint.pos[0]===t.startPoint.pos[0]&&this.startPoint.pos[1]===t.startPoint.pos[1]&&this.endPoint.pos[0]===t.endPoint.pos[0]&&this.endPoint.pos[1]===t.endPoint.pos[1])},t.setIntersectionPositions=function(t){t.forEach(function(o){o.setIntersectionPositions(t)})},t.prototype.setIntersectionPositions=function(t){var o=this,e=[];t.forEach(function(t,n){o.intersectsWith(t)&&e.push(o.intersectionPos(t))}),this.intersectionPositions=this.Util.uniqPositions(e)},t.prototype.intersectsWith=function(t){return Boolean(this.intersectionPos(t))},t.prototype.intersectionPos=function(t){if(this.equals(t))return null;if(this.isAdjacentTo(t))return null;var o=this.endPoint.pos[1]-this.startPoint.pos[1],e=this.startPoint.pos[0]-this.endPoint.pos[0],n=o*this.startPoint.pos[0]+e*this.startPoint.pos[1],i=t.endPoint.pos[1]-t.startPoint.pos[1],s=t.startPoint.pos[0]-t.endPoint.pos[0],r=i*t.startPoint.pos[0]+s*t.startPoint.pos[1],a=o*s-i*e;if(0==a)return null;var p=(s*n-e*r)/a,c=(o*r-i*n)/a;return Boolean(this.posInRange([p,c])&&t.posInRange([p,c]))?[p,c]:null},t.prototype.intersectionPos1=function(t){if(this.equals(t))return null;if(this.isAdjacentTo(t))return null;var o=(t.yIntercept-this.yIntercept)/(this.slope-t.slope),e=this.slope*o+this.yIntercept;return Boolean(this.posInRange([o,e])&&t.posInRange([o,e]))?[o,e]:null},t.prototype.isAdjacentTo=function(t){return Boolean(this.Util.samePos(this.startPoint.pos,t.startPoint.pos)||this.Util.samePos(this.startPoint.pos,t.endPoint.pos)||this.Util.samePos(this.endPoint.pos,t.endPoint.pos)||this.Util.samePos(this.endPoint.pos,t.startPoint.pos))},t.prototype.posInRange=function(t){var o=t[0],e=t[1],n=this.Util.inRange(this.startPoint.pos[0],this.endPoint.pos[0],o)&&this.Util.inRange(0,this.Util.DIM_X,o),i=this.Util.inRange(this.startPoint.pos[1],this.endPoint.pos[1],e)&&this.Util.inRange(0,this.Util.DIM_Y,e);return Boolean(n&&i)},t.intersectionCount=function(t){var o=[],e=new n.default;return t.forEach(function(e){e.setIntersectionPositions(t),o=o.concat(e.intersectionPositions)}),e.uniqPositions(o).length},t}();e.default=i,cc._RF.pop()},{"./utility":"utility"}],utility:[function(t,o,e){"use strict";cc._RF.push(o,"32a568Db51GoLdiPP0lSaQp","utility");var n=this&&this.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),i=this&&this.__decorate||function(t,o,e,n){var i,s=arguments.length,r=s<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,o,e,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(s<3?i(r):s>3?i(o,e,r):i(o,e))||r);return s>3&&r&&Object.defineProperty(o,e,r),r};Object.defineProperty(e,"__esModule",{value:!0});var s=cc._decorator,r=s.ccclass,a=(s.property,function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.DIM_X=860,o.DIM_Y=590,o}return n(o,t),o.prototype.samePos=function(t,o){var e=t[0],n=t[1],i=o[0],s=o[1];return Boolean(e===i&&n===s)},o.prototype.distance=function(t,o){var e=t[0],n=t[1],i=o[0],s=o[1];return Math.sqrt(Math.pow(i-e,2)+Math.pow(s-n,2))},o.prototype.inRange=function(t,o,e){return Boolean(e>=(t<=o?t:o)&&e<=(t<=o?o:t))},o.prototype.posInRange=function(t,o,e){var n=e[0],i=e[1],s=t[0],r=t[1],a=o[0],p=o[1],c=this.inRange(s,a,n),l=this.inRange(r,p,i);return Boolean(c&&l)},o.prototype.uniqPositions=function(t){var o=[];return t.forEach(function(t){var e=!0;o.forEach(function(o){var n=Math.floor(t[0]),i=Math.floor(t[1]),s=Math.floor(o[0]),r=Math.floor(o[1]);n===s&&i===r&&(e=!1)}),e&&o.push(t)}),o},o.prototype.clonePositions=function(t){var o=[];return t.forEach(function(t){o.push([t[0],t[1]])}),o},o.prototype.hasEnoughSpace=function(t,o){var e=!0;return o.forEach(function(o){var n=Boolean(Math.abs(t[0]-o[0])<50),i=Boolean(Math.abs(t[1]-o[1])<50);n&&i&&(e=!1)}),e},o=i([r],o)}(cc.Component));e.default=a,cc._RF.pop()},{}]},{},["ball","draw","game","line","utility"]);